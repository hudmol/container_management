<% can_edit = user_can?("manage_container") %>

<%
  top_containers = results['response']['docs']
  num_found = results['response']["numFound"].to_i
  rows = results['responseHeader']['params']['rows'].to_i
%>
<% if rows < num_found %>
  <div class="alert alert-warning">Not all results have been listed. Please refine your search.</div>
  <p>Showing <strong><%= [rows, num_found].min %></strong> of <strong><%= num_found %></strong> matching results</p>
<% else %>
  <p>Matching results: <strong><%= num_found %></strong></p>
<% end %>

<table class="table table-striped table-bordered table-condensed table-hover table-sortable table-search-results">
  <thead>
    <tr>
      <th><%= check_box_tag "select_all" %></th>
      <th>Collection/Accession</th>
      <th>Series</th>
      <th>Container Profile</th>
      <th>Indicator</th>
      <th>Barcode</th>
      <th>Current Location</th>
      <th>Voyager ID</th>
      <th>Restricted?</th>
      <th>Exported?</th>
      <th><!-- Actions --></th>
    </tr>
  </thead>
  <tbody>
    <% top_containers.each do |doc| %>
      <% container_json = ASUtils.json_parse(doc['json']) %>
      <tr>
        <td><%= check_box_tag "uri", container_json['uri'] %></td>
        <td><%= (doc['collection_display_string_u_sstr'] || [""]).first %></td>
        <td><%= (doc['series_title_u_sstr'] || [""]).first %></td>
        <td><%= (doc['container_profile_display_string_u_sstr'] || [""]).first %></td>
        <td><%= container_json['indicator'] %></td>
        <td><%= container_json['barcode'] %></td>
        <td><%= (doc['location_display_string_u_sstr'] || [""]).first %></td>
        <td><%= container_json['voyager_id'] %></td>
        <td><%= I18n.t("boolean.#{container_json['restricted']}") %></td>
        <td><%= I18n.t("boolean.#{container_json['exported_to_voyager']}") %></td>
        <td>
          <div class="btn-group pull-right">
            <%= link_to I18n.t("actions.view"), {:controller => :resolver, :action => :resolve_readonly, :uri => container_json["uri"]}, :class => "btn btn-mini" %>
            <% if can_edit %>
              <%= link_to I18n.t("actions.edit"), {:controller => :resolver, :action => :resolve_edit, :uri => container_json["uri"]}, :class => "btn btn-mini btn-primary" %>
            <% end %>
          </div>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>