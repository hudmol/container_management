<% can_edit = user_can?("manage_container") %>

<%
  multiselect = true if multiselect.nil?
  show_edit_actions = true if show_edit_actions.nil?
  top_containers = results['response']['docs']
  num_found = results['response']["numFound"].to_i
  rows = results['responseHeader']['params']['rows'].to_i
%>
<% if rows < num_found %>
  <div class="alert alert-warning">Not all results have been listed. Please refine your search.</div>
  <p>Showing <strong><%= [rows, num_found].min %></strong> of <strong><%= num_found %></strong> matching results</p>
<% else %>
  <p>Matching results: <strong><%= num_found %></strong></p>
<% end %>

<p><small>Click a column to set the sort ordering.  Hold shift to sort by multiple columns.</small></p>

<table class="table table-striped table-bordered table-condensed table-hover table-sortable table-search-results">
  <thead>
    <tr class="sortable-columns">
      <th><% if multiselect %><%= check_box_tag "select_all" %><% end %></th>
      <th>Resource/Accession</th>
      <th>Series</th>
      <th>Container Profile</th>
      <th>Indicator</th>
      <th>Barcode</th>
      <th>Current Location</th>
      <th>ILS Holding ID</th>
      <th>ILS Item ID</th>
      <th>Restricted?</th>
      <th>Exported</th>
      <% if show_edit_actions %><th><!-- Actions --></th><% end %>
    </tr>
  </thead>
  <tbody>
    <% top_containers.each do |doc| %>
      <% container_json = ASUtils.json_parse(doc['json']) %>
      <tr>
        <td>
          <% if multiselect %>
            <%= check_box_tag "uri", container_json['uri'], false, "data-display-string" => doc['title'] %>
          <% else %>
            <%= radio_button_tag "linker-item", container_json["uri"], false, :"data-object" => container_json.to_json %>
          <% end %>
        </td>
        <td class="top-container-collection">
          <% if doc['collection_identifier_stored_u_sstr'] %>
            <ul class="linked-records-listing count-<%= Array(doc['collection_identifier_stored_u_sstr']).length %>">
              <% Array(doc['collection_identifier_stored_u_sstr']).zip(Array(doc['collection_display_string_u_sstr'])).each do |identifier, display| %>
                <li><span class="collection-identifier"><%= identifier %></span> <span class="collection-display-string"><%= display %></span</li>
              <% end %>
            </ul>
          <% end %>
        </td>
        <td class="top-container-series">
          <% if doc['series_level_u_sstr'] %>
            <ul class="linked-records-listing count-<%= Array(doc['series_level_u_sstr']).length %>">
              <% Array(doc['series_level_u_sstr']).zip(Array(doc['series_identifier_stored_u_sstr'])).each do |level, identifier| %>
                <li><span class="series-level"><%= level %></span> <span class="series-identifier"><%= identifier %></span></li>
              <% end %>
            </ul>
          <% end %>
        </td>
        <td><%= Array(doc['container_profile_display_string_u_sstr']).first %></td>
        <td><%= container_json['indicator'] %></td>
        <td><%= container_json['barcode'] %></td>
        <td><%= Array(doc['location_display_string_u_sstr']).first %></td>
        <td><%= container_json['ils_holding_id'] %></td>
        <td><%= container_json['ils_item_id'] %></td>
        <td><%= I18n.t("boolean.#{container_json['restricted']}") %></td>
        <% if container_json['exported_to_ils'].blank? %>
          <td><%= I18n.t("top_container.not_exported") %></td>
        <% else %>
          <td><%= container_json['exported_to_ils'] %></td>
        <% end %>

        <% if show_edit_actions %>
        <td>
          <div class="btn-group pull-right">
            <%= link_to I18n.t("actions.view"), {:controller => :resolver, :action => :resolve_readonly, :uri => container_json["uri"]}, :class => "btn btn-mini" %>
            <% if can_edit %>
              <%= link_to I18n.t("actions.edit"), {:controller => :resolver, :action => :resolve_edit, :uri => container_json["uri"]}, :class => "btn btn-mini btn-primary" %>
            <% end %>
          </div>
        </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
